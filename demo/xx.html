<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Evosustain Driver App</title>
<style>
  body, html {
    margin: 0; padding: 0;
    font-family: 'Segoe UI', sans-serif;
    background: #f5f5f5;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  .frame {
    width: 380px;
    height: 740px;
    background: white;
    border: 8px solid #333;
    border-radius: 24px;
    box-shadow: 0 0 20px rgba(0,0,0,0.2);
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }
  .status-bar {
    height: 24px;
    background: #e3f2fd;
    padding: 0 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 12px;
    gap: 12px;
    white-space: nowrap;
    user-select: none;
  }
  header {
    background: #232f3e;
    color: white;
    padding: 1rem;
    text-align: center;
    font-weight: bold;
    position: relative;
  }
  main {
    flex: 1;
    overflow-y: auto;
    padding: 1rem;
  }
  .card {
    background: #fff;
    border-radius: 12px;
    padding: 1rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    margin-bottom: 1rem;
  }
  .button {
    display: block;
    width: 100%;
    padding: 0.7rem;
    background: #ff9900;
    border: none;
    border-radius: 10px;
    color: white;
    font-weight: bold;
    margin-top: 0.5rem;
    cursor: pointer;
  }
  nav {
    background: #eaeaea;
    display: flex;
    justify-content: space-around;
    padding: 0.6rem 0;
  }
  nav button {
    background: none;
    border: none;
    color: #232f3e;
    font-weight: bold;
    cursor: pointer;
  }
  select.route-mode {
    width: 100%;
    padding: 0.5rem;
    margin-bottom: 1rem;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-weight: bold;
    color: #232f3e;
  }
  .actions {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-top: 1rem;
  }
  #progress-bar-container {
    background: #ddd;
    border-radius: 8px;
    height: 20px;
    margin-bottom: 1rem;
    overflow: hidden;
  }
  #progress-bar {
    background: #4caf50;
    height: 100%;
    width: 0%;
    transition: width 0.5s;
    position: relative;
  }
  #progress-label {
    position: absolute;
    width: 100%;
    text-align: center;
    color: #000;
    font-size: 12px;
    line-height: 20px;
  }
  .message {
    background: #bbdefb;
    color: #0d47a1;
    padding: 0.5rem;
    border-radius: 8px;
    margin-top: 0.5rem;
    text-align: center;
    font-weight: bold;
    display: none;
  }
  /* Responsive improvements */
  @media (max-width: 400px) {
    .frame {
      width: 95vw;
      height: 90vh;
      border-radius: 20px;
      border-width: 5px;
    }
    header {
      font-size: 1rem;
      padding: 0.8rem;
    }
    nav button {
      font-size: 1rem;
    }
  }
</style>
</head>
<body>
<div class="frame">
  <div class="status-bar">
    <span id="clock">--:--:--</span>
    <span>üì∂</span>
    <span>üîã</span>
  </div>
  <header>Evosustain Driver App</header>
  <main>
    <section id="home" class="card section">
      <h3>Start Shift</h3>
      <input type="text" id="driverId" placeholder="Driver ID" style="width:100%;padding:0.5rem;" />
      <button class="button" id="startBtn">Start</button>
      <button class="button" id="breakBtn">Break</button>
      <button class="button" id="endBtn">End Shift</button>
    </section>
    <section id="route" class="card section" style="display:none;">
      <h3>Route Stops</h3>
      <input type="number" id="goto-stop" placeholder="Go to Stop #" style="width:100%;padding:0.5rem;margin:0.5rem 0;" />
      <button class="button" id="gotoBtn">Go</button>
      <label for="route-mode">Route Mode:</label>
      <select id="route-mode" class="route-mode">
        <option value="normal">Normal</option>
        <option value="fast">Smart Fast</option>
      </select>
      <ul id="stop-list"></ul>
      <p style="font-size:0.85rem;color:#444;margin-top:1rem;">100 total stops in London are grouped and listed here. Use the Smart Fast mode for optimized routing.</p>
      <button class="button" id="mapBtn">Map</button>
    </section>
    <section id="map" class="card section" style="display:none;">
      <h3>Map</h3>
      <p>Simulated route in London.</p>
      <div id="map-canvas">Simulated Map of London Route</div>
      <button class="button" id="drawRouteBtn">Go Route</button>
    </section>
    <section id="summary" class="card section" style="display:none;">
      <div id="progress-bar-container">
        <div id="progress-bar"><span id="progress-label">0%</span></div>
      </div>
      <h3>Summary</h3>
      <p id="summary-data">Loading...</p>
      <button class="button" id="submitReportBtn">Submit</button>
      <div id="summaryMessage" class="message"></div>
    </section>
  </main>
  <nav>
    <button id="navHome">üè† Home</button>
    <button id="navRoute">üìã Route</button>
    <button id="navMap">üó∫Ô∏è Map</button>
    <button id="navSummary">üìä Summary</button>
  </nav>
</div>

<script>
  // Real-time clock
  function updateClock() {
    const clock = document.getElementById('clock');
    const now = new Date();
    clock.textContent = now.toLocaleTimeString();
  }
  setInterval(updateClock, 1000);
  updateClock();

  // Simulated stops with lat/lon
  const stops = Array.from({ length: 100 }, (_, i) => ({
    id: i + 1,
    label: `Stop ${i + 1}, London, UK`,
    lat: 51.5 + Math.random() * 0.1,
    lon: -0.15 + Math.random() * 0.1
  }));

  let confirmed = 0;
  let delayed = 0;
  let noted = 0;

  function show(sectionId) {
    document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
    const target = document.getElementById(sectionId);
    if (target) target.style.display = 'block';
  }

  function showMessage(msgId, text) {
    const msgBox = document.getElementById(msgId);
    msgBox.innerText = text;
    msgBox.style.display = 'block';
    setTimeout(() => {
      msgBox.style.display = 'none';
    }, 4000);
  }

  function renderRoute() {
    const list = document.getElementById('stop-list');
    list.innerHTML = '';
    const mode = document.getElementById('route-mode').value;
    let data = stops;
    if (mode === 'fast') {
      const baseLat = 51.5074,
        baseLon = -0.1278;
      data = [...stops].sort((a, b) => {
        const dA = Math.hypot(baseLat - a.lat, baseLon - a.lon);
        const dB = Math.hypot(baseLat - b.lat, baseLon - b.lon);
        return dA - dB;
      });
    }
    data.forEach(stop => {
      const li = document.createElement('li');
      li.setAttribute('id', `stop-${stop.id}`);

      const info = document.createElement('div');
      info.textContent = stop.label;

      const actions = document.createElement('div');
      actions.className = 'actions';

      const btnConfirm = document.createElement('button');
      btnConfirm.className = 'button';
      btnConfirm.textContent = 'Confirm';
      btnConfirm.onclick = () => {
        if (!btnConfirm.disabled) {
          alert(`Confirmed: ${stop.label}`);
          btnConfirm.style.backgroundColor = '#4caf50';
          btnConfirm.textContent = 'Confirmed';
          btnConfirm.disabled = true;
          confirmed++;
          btnDelay.style.backgroundColor = '#ff9900';
          btnDelay.textContent = 'Delay';
          btnDelay.disabled = false;
          delayed = Math.max(0, delayed - 1);
          btnNote.style.backgroundColor = '#ff9900';
          btnNote.textContent = 'Note';
          btnNote.disabled = false;
          noted = Math.max(0, noted - 1);
          updateSummary();
        }
      };

      const btnDelay = document.createElement('button');
      btnDelay.className = 'button';
      btnDelay.textContent = 'Delay';
      btnDelay.onclick = () => {
        if (!btnDelay.disabled) {
          alert(`Delay reported: ${stop.label}`);
          btnDelay.style.backgroundColor = '#f44336';
          btnDelay.textContent = 'Delayed';
          btnDelay.disabled = true;
          delayed++;
          updateSummary();
        }
      };

      const btnNote = document.createElement('button');
      btnNote.className = 'button';
      btnNote.textContent = 'Note';
      btnNote.onclick = () => {
        if (!btnNote.disabled) {
          alert(`Note added for: ${stop.label}`);
          btnNote.style.backgroundColor = '#2196f3';
          btnNote.textContent = 'Noted';
          btnNote.disabled = true;
          noted++;
          updateSummary();
        }
      };

      actions.appendChild(btnConfirm);
      actions.appendChild(btnDelay);
      actions.appendChild(btnNote);

      li.appendChild(info);
      li.appendChild(actions);
      list.appendChild(li);
    });
  }

  function updateSummary() {
    const total = stops.length;
    const progressBar = document.getElementById('progress-bar');
    const progressLabel = document.getElementById('progress-label');
    const summaryData = document.getElementById('summary-data');
    const percent = Math.round((confirmed / total) * 100);

    progressBar.style.width = `${percent}%`;
    progressLabel.textContent = `${percent}%`;

    if (percent < 30) {
      progressBar.style.backgroundColor = '#f44336'; // red
    } else if (percent < 70) {
      progressBar.style.backgroundColor = '#ffeb3b'; // yellow
    } else {
      progressBar.style.backgroundColor = '#4caf50'; // green
    }

    summaryData.innerHTML = `
      Confirmed: ${confirmed} / ${total}<br/>
      Delayed: ${Math.max(0, delayed)}<br/>
      Noted: ${Math.max(0, noted)}
    `;

    if (confirmed === total) {
      setTimeout(() => alert('üéâ Route fully completed! Great job!'), 300);
    }
  }

  function goToStop() {
    const id = parseInt(document.getElementById('goto-stop').value);
    if (!isNaN(id) && id > 0 && id <= stops.length) {
      const el = document.getElementById(`stop-${id}`);
      if (el) {
        el.scrollIntoView({ behavior: 'smooth', block: 'start' });
        el.style.backgroundColor = 'yellow';
        setTimeout(() => {
          el.style.backgroundColor = '';
        }, 2000);
      }
    } else {
      alert('Invalid stop number. Must be between 1 and 100.');
    }
  }

  function drawRoute() {
    const canvas = document.getElementById('map-canvas');
    canvas.innerHTML = '';
    const svgNS = 'http://www.w3.org/2000/svg';
    const svg = document.createElementNS(svgNS, 'svg');
    svg.setAttribute('width', '100%');
    svg.setAttribute('height', '300');

    for (let i = 0; i < stops.length - 1; i++) {
      const x1 = 20 + (i % 10) * 30;
      const y1 = 30 + Math.floor(i / 10) * 30;
      const x2 = 20 + ((i + 1) % 10) * 30;
      const y2 = 30 + Math.floor((i + 1) / 10) * 30;
      const line = document.createElementNS(svgNS, 'line');
      line.setAttribute('x1', x1);
      line.setAttribute('y1', y1);
      line.setAttribute('x2', x2);
      line.setAttribute('y2', y2);
      line.setAttribute('stroke', 'red');
      line.setAttribute('stroke-width', '2');
      svg.appendChild(line);
    }

    stops.forEach((stop, index) => {
      const cx = 20 + (index % 10) * 30;
      const cy = 30 + Math.floor(index / 10) * 30;
      const circle = document.createElementNS(svgNS, 'circle');
      circle.setAttribute('cx', cx);
      circle.setAttribute('cy', cy);
      circle.setAttribute('r', 6);
      circle.setAttribute('fill', 'blue');
      circle.setAttribute('data-id', stop.id);
      circle.style.cursor = 'pointer';
      circle.addEventListener('click', () => {
        alert(`Selected: ${stop.label}`);
        const el = document.getElementById(`stop-${stop.id}`);
        if (el) {
          el.scrollIntoView({ behavior: 'smooth', block: 'center' });
          el.style.backgroundColor = '#ffff99';
          setTimeout(() => {
            el.style.backgroundColor = '';
          }, 1500);
          const confirmBtn = el.querySelector('button');
          if (confirmBtn && !confirmBtn.disabled) confirmBtn.click();
        }
      });
      svg.appendChild(circle);
    });
    canvas.appendChild(svg);
  }

  window.addEventListener('DOMContentLoaded', () => {
    document.getElementById('startBtn').addEventListener('click', () => {
      show('route');
      renderRoute();
      updateSummary();
    });
    document.getElementById('endBtn').addEventListener('click', () => {
      show('summary');
      updateSummary();
    });
    document.getElementById('breakBtn').addEventListener('click', () => {
      alert('Break started');
    });
    document.getElementById('gotoBtn').addEventListener('click', goToStop);
    document.getElementById('route-mode').addEventListener('change', () => {
      renderRoute();
      updateSummary();
    });
    document.getElementById('mapBtn').addEventListener('click', () => show('map'));
    document.getElementById('drawRouteBtn').addEventListener('click', drawRoute);
    document.getElementById('navHome').addEventListener('click', () => show('home'));
    document.getElementById('navRoute').addEventListener('click', () => {
      show('route');
      renderRoute();
      updateSummary();
    });
    document.getElementById('navMap').addEventListener('click', () => show('map'));
    document.getElementById('navSummary').addEventListener('click', () => {
      show('summary');
      updateSummary();
    });
  });
</script>
</body>
</html>
