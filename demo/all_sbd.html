<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=380, initial-scale=1.0" />
  <title>EvoSustain App</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    :root {
      --eco-green: #2e7d32;
      --eco-light: #e8f5e9;
      --eco-blue: #1976d2;
      --eco-gradient: linear-gradient(90deg,#1976d2 40%,#43a047 100%);
      --eco-shadow: 0 2px 14px rgba(67,160,71,0.10);
      --eco-card: #fff;
    }
    body, html {
      margin: 0; padding: 0;
      background: var(--eco-light);
      font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
      height: 100vh; color: #113; 
      display: flex; align-items: center; justify-content: center;
    }
    .device-frame {
      width: 380px; height: 770px; border: 8px solid var(--eco-green); border-radius: 32px;
      background: #fff; box-shadow: var(--eco-shadow),0 0 0 6px #e8f5e9;
      display: flex; flex-direction: column; overflow: hidden; position: relative;
    }
    .status-bar { height: 24px; background: #e3f2fd; padding: 0 12px;
      display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: #2e7d32; font-weight: bold;}
    .main-switcher { display: flex; background: var(--eco-gradient); color: #fff; font-weight: bold; font-size: 1.05rem; }
    .main-switcher button {
      flex: 1; border: none; background: none; color: inherit; padding: 1.02rem 0 0.81rem 0;
      font-size: inherit; cursor: pointer; font-weight: 700; border-bottom: 4px solid transparent;
      transition: background 0.18s, border-bottom 0.19s; letter-spacing: 0.01em;
    }
    .main-switcher button.active {
      background: rgba(255,255,255,0.15);
      border-bottom: 4px solid #a5d6a7;
    }
    .app-view { flex: 1; display: none; flex-direction: column; min-height: 0; background: #f6fefc; }
    .app-view.active { display: flex; }
    header {
      background: var(--eco-gradient); color: #fff; padding: 0.95rem;
      text-align: center; font-size: 1.25rem; font-weight: bold; letter-spacing:0.02em;
      border-bottom: 1px solid #e0e0e0; box-shadow: 0 3px 14px rgba(33,150,243,0.09);
      display: flex; align-items: center; justify-content: center; gap: 0.65em;
    }
    header .eco-icon { font-size: 1.38em; vertical-align: -3px;}
    main { flex: 1; padding: 0.62rem 0.72rem 0 0.72rem; overflow-y: auto; }
    .card {
      background: var(--eco-card); border-radius: 16px; padding: 1.1rem;
      box-shadow: var(--eco-shadow); margin-bottom: 1.19rem; position: relative;
    }
    .button, .btn {
      background: linear-gradient(90deg, #43a047 60%, #1976d2 120%);
      color: #fff; border: none; border-radius: 10px; padding: 0.7rem 0;
      font-weight: 700; margin-top: 0.45rem; width: 100%; font-size: 1rem; cursor: pointer;
      box-shadow: 0 2px 6px rgba(76,175,80,0.08); transition: background 0.23s, transform 0.18s;
    }
    .button:disabled, .btn:disabled { background: #bdbdbd !important; color: #fff !important; cursor: not-allowed; }
    nav { display: flex; justify-content: space-around; background: #e3f2fd; padding: 0.46rem 0;
      border-top: 1px solid #e0e0e0; box-shadow: 0 -1px 6px #b2dfdb14; }
    nav button {
      background: none; border: none; color: #1976d2; font-size: 1.12rem; cursor: pointer;
      border-radius: 10px; padding: 0.38rem 0.83rem; font-weight: 600; transition: background 0.18s;
      display: flex; align-items: center; gap: 0.3em;
    }
    nav button.active, nav button:focus {
      background: #c5e1a5; color: #1976d2;
    }
    .eco-tip {
      background: #e0f2f1; color: #00796b; padding: 0.5rem 1rem; border-radius: 12px;
      margin: 0.6rem 0 1rem 0; font-size: 0.99rem; text-align: center; font-weight: 600;
      box-shadow: 0 2px 7px rgba(76,175,80,0.04);
    }
    .section { display: none; }
    .section.active { display: block; }
    /* Responsive for mobile */
    @media (max-width: 450px) {
      .device-frame { width: 99vw; height: 100vh; border-radius: 0;}
    }
  </style>
</head>
<body>
  <div class="device-frame">
    <div class="status-bar">
      <span>9:41 AM</span>
      <span>ğŸ“¶ ğŸ”‹</span>
    </div>
    <div class="main-switcher">
      <button id="btnStore" class="active">ğŸ¬ Store</button>
      <button id="btnBusiness">ğŸ¢ Business</button>
      <button id="btnDriver">ğŸšš Driver</button>
    </div>
    <!-- STORE APP -->
    <div id="storeApp" class="app-view active">
      <header><span class="eco-icon">ğŸ¬</span>Store App</header>
      <main>
        <div class="eco-tip">ğŸ’¡ Request, track, and manage your eco collections!</div>
        <section id="s-login" class="card section active">
          <h2>Login / Sign-Up</h2>
          <input type="text" placeholder="Store ID" style="width:100%;padding:0.5rem;margin-top:0.5rem;border-radius:8px;border:1px solid #ccc;">
          <button class="button" onclick="showStoreSection('s-request')">Login</button>
          <button class="button" onclick="showStoreSection('s-request')">Scan QR Code</button>
        </section>
        <section id="s-request" class="card section">
          <h2>Request Collection</h2>
          <button class="button" onclick="showStoreSection('s-login')">â† Back</button>
          <p><strong>Location:</strong> Auto-filled</p>
          <p><strong>Bin Type:</strong> Auto-filled</p>
          <input type="number" placeholder="Volume (mÂ³)" style="width:100%;padding:0.5rem;border-radius:8px;border:1px solid #ccc;">
          <select style="width:100%;padding:0.5rem;border-radius:8px;border:1px solid #ccc;margin-top:0.5rem;">
            <option>Select Time Window</option>
            <option>9:00â€“11:00</option>
            <option>11:00â€“13:00</option>
            <option>13:00â€“15:00</option>
          </select>
          <textarea placeholder="Additional Notes" rows="3" style="width:100%;margin-top:0.5rem;padding:0.5rem;border-radius:8px;border:1px solid #ccc;"></textarea>
          <button class="button" onclick="showStoreSection('s-track')">Submit Request</button>
        </section>
        <section id="s-track" class="card section">
          <h2>Track Collection</h2>
          <button class="button" onclick="showStoreSection('s-request')">â† Back</button>
          <ul>
            <li>Requested âœ…</li>
            <li>Accepted âœ…</li>
            <li><strong>In Transit ğŸšš</strong></li>
            <li>Collected â³</li>
          </ul>
        </section>
        <section id="s-history" class="card section">
          <h2>Pickup History</h2>
          <button class="button" onclick="showStoreSection('s-track')">â† Back</button>
          <p>ğŸ“… 20 May - Food Waste - <strong>Collected</strong></p>
          <p>ğŸ“… 18 May - Recycling - <strong>Collected</strong></p>
          <p>ğŸ“… 16 May - Glass - <strong>Collected</strong></p>
          <p>ğŸ“… 14 May - Cardboard - <strong>Missed</strong></p>
          <p>ğŸ“… 12 May - Plastic - <strong>Collected</strong></p>
          <p>ğŸ“… 10 May - General Waste - <strong>Collected</strong></p>
        </section>
        <section id="s-notifications" class="card section">
          <h2>Notifications</h2>
          <button class="button" onclick="showStoreSection('s-history')">â† Back</button>
          <ul>
            <li>ğŸ“¢ New collection slot available for weekends.</li>
            <li>âœ… Your last pickup on 20 May was successful.</li>
            <li>ğŸ“¦ New bins will be delivered next week.</li>
          </ul>
        </section>
        <section id="s-orders" class="card section">
          <h2>Order Supplies</h2>
          <button class="button" onclick="showStoreSection('s-notifications')">â† Back</button>
          <select style="width:100%;padding:0.5rem;margin-bottom:0.5rem;">
            <option>Select Item</option>
            <option>New Bin</option>
            <option>Bin Liners</option>
            <option>QR Code Stickers</option>
            <option>Trash Bags</option>
            <option>Cleaning Products</option>
            <option>Other</option>
          </select>
          <input type="number" placeholder="Quantity" style="width:100%;padding:0.5rem;margin-bottom:0.5rem;">
          <textarea placeholder="Additional Notes (optional)" rows="3" style="width:100%;padding:0.5rem;border-radius:8px;border:1px solid #ccc;"></textarea>
          <button class="button" onclick="alert('Order request submitted!')">Submit Order</button>
        </section>
        <section id="s-help" class="card section">
          <h2>Settings & Help</h2>
          <button class="button" onclick="showStoreSection('s-orders')">â† Back</button>
          <p><strong>Support Chat:</strong> Coming soon</p>
          <p><strong>FAQ:</strong> How to request, track, and update your profile</p>
          <p><strong>Profile:</strong> Edit and update your store info (coming soon)</p>
        </section>
      </main>
      <nav>
        <button onclick="showStoreSection('s-login')">ğŸ  Home</button>
        <button onclick="showStoreSection('s-request')">ğŸ—‘ï¸ Request</button>
        <button onclick="showStoreSection('s-track')">ğŸ“¦ Track</button>
        <button onclick="showStoreSection('s-history')">ğŸ“œ History</button>
        <button onclick="showStoreSection('s-notifications')">ğŸ”” Notifications</button>
        <button onclick="showStoreSection('s-orders')">â• Order</button>
        <button onclick="showStoreSection('s-help')">â“ Help</button>
      </nav>
    </div>
    <!-- BUSINESS APP -->
    <div id="businessApp" class="app-view">
      <header><span class="eco-icon">ğŸ¢</span>Business App</header>
      <main>
        <div class="eco-tip">ğŸ’¡ Manage drivers, requests and eco operations efficiently.</div>
        <section id="b-login" class="card section active">
          <h2>Login</h2>
          <input type="text" placeholder="Email" style="width:100%;padding:0.5rem;margin-bottom:0.5rem;border-radius:8px;border:1px solid #ccc;">
          <input type="password" placeholder="Password" style="width:100%;padding:0.5rem;border-radius:8px;border:1px solid #ccc;">
          <button class="button" onclick="showBusinessSection('b-home')">Sign In</button>
        </section>
        <section id="b-home" class="card section">
          <h3>Welcome Business App</h3>
          <p>ğŸ“Š Monitor activity and manage your business easily.</p>
        </section>
        <section id="b-dashboard" class="card section">
          <h3>KPIs Overview</h3>
          <p>â± Avg. Route Time: 32 min</p>
          <p>âœ… Completed Tasks: 440</p>
          <p>âš  Alerts: 3 system issues</p>
        </section>
        <section id="b-clients" class="card section">
          <h3>Stores</h3>
          <p>Store A â€“ ğŸ“¦ 120 pickups</p>
          <p>Store B â€“ ğŸ“¦ 87 pickups</p>
        </section>
        <section id="b-requests" class="card section">
          <h3>Pickup Requests</h3>
          <p>ğŸ§¾ Request X â€“ <button class="button">Approve</button> <button class="button">Decline</button></p>
          <p>ğŸ§¾ Request Y â€“ <button class="button">Approve</button> <button class="button">Reschedule</button></p>
        </section>
        <section id="b-planning" class="card section">
          <h3>Planning</h3>
          <p>ğŸ—“ Calendar view</p>
          <p>ğŸ“ Optimized route for 6 vehicles</p>
        </section>
        <section id="b-assignment" class="card section">
          <h3>Assign Drivers</h3>
          <p>Driver 1 â¡ Route A</p>
          <p>Driver 2 â¡ Route B</p>
        </section>
        <section id="b-mapview" class="card section">
          <h3>Live Map</h3>
          <div id="map" style="width:100%;height:170px;border-radius:12px;"></div>
        </section>
        <section id="b-performance" class="card section">
          <h3>Performance</h3>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:0.5rem;text-align:center;font-size:0.9rem;">
            <div style="background:#e3f2fd;padding:0.6rem;border-radius:10px;">
              â±<br><strong>92%</strong><br>Efficiency
            </div>
            <div style="background:#e3f2fd;padding:0.6rem;border-radius:10px;">
              â›½<br><strong>178L</strong><br>Fuel Saved
            </div>
            <div style="background:#e3f2fd;padding:0.6rem;border-radius:10px;">
              âœ…<br><strong>1040</strong><br>Pickups
            </div>
            <div style="background:#e3f2fd;padding:0.6rem;border-radius:10px;">
              ğŸ›‘<br><strong>95%</strong><br>No Accidents
            </div>
            <div style="background:#e3f2fd;padding:0.6rem;border-radius:10px;">
              âš ï¸<br><strong>2</strong><br>With Incidents
            </div>
            <div style="background:#e3f2fd;padding:0.6rem;border-radius:10px;">
              ğŸ§­<br><strong>88%</strong><br>Smooth Drive
            </div>
            <div style="background:#e3f2fd;padding:0.6rem;border-radius:10px;">
              ğŸ“‰<br><strong>-12%</strong><br>Downtime
            </div>
          </div>
        </section>
        <section id="b-driver-performance" class="card section">
          <h3>Driver Stats</h3>
          <p>No Incidents: 9/10 drivers</p>
          <p>Idle Time: -15%</p>
        </section>
        <section id="b-settings" class="card section">
          <h3>Settings</h3>
          <p>ğŸ” Change Password</p>
          <p>ğŸŒ Language</p>
          <p>ğŸ“§ Notifications</p>
        </section>
      </main>
      <nav>
        <button onclick="showBusinessSection('b-home')">ğŸ  Home</button>
        <button onclick="showBusinessSection('b-dashboard')">ğŸ“‹ KPIs</button>
        <button onclick="showBusinessSection('b-clients')">ğŸ‘¥ Stores</button>
        <button onclick="showBusinessSection('b-requests')">ğŸ§¾ Pickup</button>
        <button onclick="showBusinessSection('b-planning')">ğŸ—“ Planning</button>
        <button onclick="showBusinessSection('b-assignment')">ğŸšš Drivers</button>
        <button onclick="showBusinessSection('b-mapview')">ğŸ—º Map</button>
        <button onclick="showBusinessSection('b-performance')">ğŸ“Š Performance</button>
        <button onclick="showBusinessSection('b-driver-performance')">ğŸ“ˆ Stats</button>
        <button onclick="showBusinessSection('b-settings')">âš™ Settings</button>
      </nav>
    </div>
    <!-- DRIVER APP -->
    <div id="driverApp" class="app-view">
      <header><span class="eco-icon">ğŸšš</span>Driver App</header>
      <main>
        <div class="eco-tip">ğŸ’¡ Start shift, confirm stops, optimize your green route.</div>
        <section id="d-home" class="card section active">
          <h3>Start Shift</h3>
          <input type="text" id="driverIdInput" placeholder="Driver ID" style="width:100%;padding:0.5rem;" />
          <button class="button" id="startBtn">Start</button>
          <button class="button" id="breakBtn">Break</button>
          <button class="button" id="endBtn">End Shift</button>
          <button class="button" id="callSupportBtnHome">Call Support</button>
        </section>
        <section id="d-route" class="card section">
          <h3>Route Stops</h3>
          <input type="number" id="goto-stop" placeholder="Go to Stop #" style="width:100%;padding:0.5rem;margin:0.5rem 0;" />
          <button class="button" id="gotoBtn">Go</button>
          <label for="route-mode">Route Mode:</label>
          <select id="route-mode" class="route-mode">
            <option value="normal">Normal</option>
            <option value="fast">Smart Fast</option>
          </select>
          <ul id="stop-list"></ul>
          <p style="font-size:0.88rem;color:#1976d2;margin-top:1rem;">100 stops in London. Use Smart Fast for optimized eco routing.</p>
          <button class="button" id="mapBtn">Map</button>
          <button class="button" id="callSupportBtnRoute">Call Support</button>
        </section>
        <section id="d-map" class="card section">
          <h3>Map</h3>
          <p>Simulated route in London.</p>
          <div id="map-canvas">Map</div>
          <button class="button" id="drawRouteBtn">Go Route</button>
        </section>
        <section id="d-summary" class="card section">
          <div id="progress-bar-container" style="background:#e3f2fd;border-radius:8px;height:20px;margin-bottom:1rem;overflow:hidden;">
            <div id="progress-bar" style="background:#4caf50;height:100%;width:0%;transition:width 0.5s;position:relative;">
              <span id="progress-label" style="position:absolute;width:100%;text-align:center;color:#0d47a1;font-size:12px;line-height:20px;">0%</span>
            </div>
          </div>
          <h3>Summary</h3>
          <p id="summary-data">Loading...</p>
          <button class="button" id="submitReportBtn">Submit</button>
          <button class="button" id="callSupportBtnSummary">Call Support</button>
        </section>
      </main>
      <nav>
        <button onclick="showDriverSection('d-home')">ğŸ  Home</button>
        <button onclick="showDriverSection('d-route')">ğŸ§­ Route</button>
        <button onclick="showDriverSection('d-map')">ğŸ—º Map</button>
        <button onclick="showDriverSection('d-summary')">ğŸ“Š Summary</button>
      </nav>
    </div>
  </div>
  <script>
    // --- Top Module Switcher
    function switchApp(app) {
      document.querySelectorAll('.app-view').forEach(view => view.classList.remove('active'));
      document.getElementById(app + 'App').classList.add('active');
      document.querySelectorAll('.main-switcher button').forEach(btn => btn.classList.remove('active'));
      document.getElementById('btn' + app.charAt(0).toUpperCase() + app.slice(1)).classList.add('active');
    }
    document.getElementById('btnStore').onclick = ()=>switchApp('store');
    document.getElementById('btnBusiness').onclick = ()=>switchApp('business');
    document.getElementById('btnDriver').onclick = ()=>switchApp('driver');

    // --- Store Navigation
    function showStoreSection(id) {
      document.querySelectorAll('#storeApp .section').forEach(s=>s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    // --- Business Navigation
    function showBusinessSection(id) {
      document.querySelectorAll('#businessApp .section').forEach(s=>s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      if(id==='b-mapview' && !window.bizMapLoaded) {
        setTimeout(() => {
          let map = L.map('map').setView([51.505, -0.09], 12);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom: 19}).addTo(map);
          window.bizMapLoaded = true;
        }, 150);
      }
    }

    // --- Driver Navigation & Logic
    let stops = Array.from({ length: 100 }, (_, i) => ({
      id: i + 1, label: `Stop ${i + 1}, London, UK`,
      lat: 51.5 + Math.random() * 0.1, lon: -0.15 + Math.random() * 0.1, status: 'pending'
    }));
    function showDriverSection(id) {
      document.querySelectorAll('#driverApp .section').forEach(s=>s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      if(id==='d-route'){renderRoute(); updateSummary(); drawRoute();}
      if(id==='d-map'){drawRoute();}
      if(id==='d-summary'){updateSummary();}
    }
    // Driver Route/Stops logic (as in your file)
    function renderRoute() {
      const list = document.getElementById('stop-list');
      if (!list) return;
      list.innerHTML = '';
      const mode = document.getElementById('route-mode').value;
      let displayStops = [...stops];
      if (mode === 'fast') {
        const baseLat = 51.5074, baseLon = -0.1278;
        displayStops = [...stops].sort((a, b) => {
          if (a.status === "confirmed" && b.status !== "confirmed") return 1;
          if (a.status !== "confirmed" && b.status === "confirmed") return -1;
          if (a.status === "confirmed" && b.status === "confirmed") return 0;
          const dA = Math.hypot(baseLat - a.lat, baseLon - a.lon);
          const dB = Math.hypot(baseLat - b.lat, baseLon - b.lon);
          return dA - dB;
        });
      } else {
        displayStops = [...stops].sort((a, b) => {
          if (a.status === "confirmed" && b.status !== "confirmed") return 1;
          if (a.status !== "confirmed" && b.status === "confirmed") return -1;
          return a.id - b.id;
        });
      }
      displayStops.forEach(stop => {
        const li = document.createElement('li');
        li.setAttribute('id', `stop-${stop.id}`);
        li.className = stop.status !== 'pending' ? stop.status : '';
        const info = document.createElement('div'); info.textContent = stop.label;
        const actions = document.createElement('div'); actions.className = 'actions';
        const btnConfirm = document.createElement('button'); btnConfirm.className = 'button';
        btnConfirm.textContent = stop.status === 'confirmed' ? 'Confirmed' : 'Confirm';
        btnConfirm.disabled = stop.status === 'confirmed'; btnConfirm.style.backgroundColor = stop.status === 'confirmed' ? '#4caf50' : '';
        btnConfirm.onclick = () => {
          if (stop.status !== 'confirmed') { stop.status = 'confirmed'; renderRoute(); updateSummary(); drawRoute();}
        };
        const btnDelay = document.createElement('button'); btnDelay.className = 'button';
        btnDelay.textContent = stop.status === 'delayed' ? 'Delayed' : 'Delay';
        btnDelay.disabled = stop.status === 'confirmed' || stop.status === 'delayed'; btnDelay.style.backgroundColor = stop.status === 'delayed' ? '#f44336' : '';
        btnDelay.onclick = () => {
          if (stop.status !== 'confirmed' && stop.status !== 'delayed') { stop.status = 'delayed'; renderRoute(); updateSummary(); drawRoute();}
        };
        const btnNote = document.createElement('button'); btnNote.className = 'button';
        btnNote.textContent = stop.status === 'noted' ? 'Noted' : 'Note';
        btnNote.disabled = stop.status === 'confirmed' || stop.status === 'noted'; btnNote.style.backgroundColor = stop.status === 'noted' ? '#ff9800' : '';
        btnNote.onclick = () => {
          if (stop.status !== 'confirmed' && stop.status !== 'noted') { stop.status = 'noted'; renderRoute(); updateSummary(); drawRoute();}
        };
        actions.appendChild(btnConfirm); actions.appendChild(btnDelay); actions.appendChild(btnNote);
        li.appendChild(info); li.appendChild(actions); list.appendChild(li);
      });
    }
    function updateSummary() {
      const total = stops.length;
      const confirmedCount = stops.filter(s => s.status === "confirmed").length;
      const delayedCount = stops.filter(s => s.status === "delayed").length;
      const notedCount = stops.filter(s => s.status === "noted").length;
      const progressBar = document.getElementById('progress-bar');
      const progressLabel = document.getElementById('progress-label');
      const summaryData = document.getElementById('summary-data');
      const percent = Math.round((confirmedCount / total) * 100);
      progressBar.style.width = `${percent}%`;
      progressLabel.textContent = `${percent}%`;
      if (percent < 30) { progressBar.style.backgroundColor = '#f44336'; }
      else if (percent < 70) { progressBar.style.backgroundColor = '#ffeb3b'; }
      else { progressBar.style.backgroundColor = '#4caf50'; }
      summaryData.innerHTML = `Confirmed: ${confirmedCount} / ${total}<br/>Delayed: ${delayedCount}<br/>Noted: ${notedCount}`;
    }
    function goToStop() {
      const id = parseInt(document.getElementById('goto-stop').value);
      if (!isNaN(id) && id > 0 && id <= stops.length) {
        const el = document.getElementById(`stop-${id}`);
        if (el) {
          el.scrollIntoView({ behavior: 'smooth', block: 'start' });
          el.style.backgroundColor = '#fff59d';
          setTimeout(() => { el.style.backgroundColor = ''; }, 1800);
        }
      }
    }
    function drawRoute() {
      const canvas = document.getElementById('map-canvas');
      if (!canvas) return;
      canvas.innerHTML = '';
      const svgNS = 'http://www.w3.org/2000/svg';
      const width = 300, height = 190, paddingX = 20, paddingY = 22, stepX = 26, stepY = 15;
      const svg = document.createElementNS(svgNS, 'svg');
      svg.setAttribute('width', width); svg.setAttribute('height', height);
      for (let i = 0; i < stops.length - 1; i++) {
        const x1 = paddingX + (i % 10) * stepX;
        const y1 = paddingY + Math.floor(i / 10) * stepY;
        const x2 = paddingX + ((i + 1) % 10) * stepX;
        const y2 = paddingY + Math.floor((i + 1) / 10) * stepY;
        const line = document.createElementNS(svgNS, 'line');
        line.setAttribute('x1', x1); line.setAttribute('y1', y1);
        line.setAttribute('x2', x2); line.setAttribute('y2', y2);
        line.setAttribute('stroke', '#bdbdbd'); line.setAttribute('stroke-width', '1');
        svg.appendChild(line);
      }
      stops.forEach((stop, index) => {
        const cx = paddingX + (index % 10) * stepX;
        const cy = paddingY + Math.floor(index / 10) * stepY;
        const circle = document.createElementNS(svgNS, 'circle');
        circle.setAttribute('cx', cx); circle.setAttribute('cy', cy); circle.setAttribute('r', 8);
        let fill = '#42a5f5';
        if (stop.status === 'confirmed') fill = '#4caf50';
        else if (stop.status === 'delayed') fill = '#f44336';
        else if (stop.status === 'noted') fill = '#ff9800';
        circle.setAttribute('fill', fill); circle.setAttribute('stroke', '#222'); circle.setAttribute('stroke-width', '1');
        svg.appendChild(circle);
        const text = document.createElementNS(svgNS, 'text');
        text.setAttribute('x', cx); text.setAttribute('y', cy + 4); text.setAttribute('text-anchor', 'middle');
        text.setAttribute('font-size', '7'); text.setAttribute('fill', '#fff'); text.textContent = stop.id;
        svg.appendChild(text);
      });
      canvas.appendChild(svg);
    }
    setTimeout(() => {
      document.getElementById('startBtn').onclick = ()=>showDriverSection('d-route');
      document.getElementById('endBtn').onclick = ()=>showDriverSection('d-summary');
      document.getElementById('breakBtn').onclick = ()=>alert('Break started');
      document.getElementById('gotoBtn').onclick = goToStop;
      document.getElementById('route-mode').onchange = ()=>{renderRoute();updateSummary();drawRoute();};
      document.getElementById('mapBtn').onclick = ()=>showDriverSection('d-map');
      document.getElementById('drawRouteBtn').onclick = drawRoute;
      document.getElementById('submitReportBtn').onclick = ()=>alert('Eco report submitted! Great job! ğŸŒ±');
      document.getElementById('callSupportBtnHome').onclick = ()=>alert('Calling support...');
      document.getElementById('callSupportBtnRoute').onclick = ()=>alert('Calling support...');
      document.getElementById('callSupportBtnSummary').onclick = ()=>alert('Calling support...');
    }, 350);
  </script>
</body>
</html>
