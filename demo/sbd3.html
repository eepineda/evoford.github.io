<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=375, initial-scale=1.0" />
  <title>EvoSustain London: Unified Eco App</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    :root {
      --eco-green: #43a047;
      --eco-light: #e8f5e9;
      --eco-accent: #b2dfdb;
      --eco-blue: #1976d2;
      --eco-bg: #f6fefc;
      --header-grad: linear-gradient(90deg, #43a047 0%, #1976d2 100%);
      --card-shadow: 0 2px 9px rgba(67,160,71,0.10);
      --active-tab: #c5e1a5;
    }
    body, html {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
      background: var(--eco-bg);
      color: #155724;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      min-width: 375px;
    }
    .device-frame {
      width: 375px;
      height: 770px;
      border: 8px solid var(--eco-green);
      border-radius: 32px;
      background: #fff;
      box-shadow: 0 0 24px rgba(60,160,60,0.08), 0 0 0 4px #fff;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
    }
    .status-bar {
      height: 24px;
      background: #e3f2fd;
      padding: 0 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      color: #2e7d32;
      font-weight: bold;
    }
    .main-switcher {
      display: flex;
      background: var(--header-grad);
      color: #fff;
      font-weight: bold;
      font-size: 1.1rem;
      box-shadow: 0 2px 6px rgba(67,160,71,0.07);
    }
    .main-switcher button {
      flex: 1;
      border: none;
      background: none;
      color: inherit;
      padding: 1.05rem 0 0.75rem 0;
      font-size: inherit;
      cursor: pointer;
      font-weight: 700;
      border-bottom: 4px solid transparent;
      transition: background 0.18s, border-bottom 0.18s;
      letter-spacing: 0.01em;
    }
    .main-switcher button.active {
      background: rgba(255,255,255,0.12);
      border-bottom: 4px solid var(--active-tab);
    }
    .app-view {
      flex: 1;
      display: none;
      flex-direction: column;
      min-height: 0;
      overflow: hidden;
      background: var(--eco-light);
      animation: fadeIn 0.45s;
    }
    .app-view.active {
      display: flex;
    }
    header {
      background: var(--header-grad);
      color: #fff;
      padding: 0.92rem;
      text-align: center;
      font-size: 1.27rem;
      font-weight: bold;
      border-bottom: 1px solid #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.7em;
    }
    header .eco-icon {
      font-size: 1.42em;
      vertical-align: -4px;
    }
    main {
      flex: 1;
      padding: 0.5rem 0.6rem 0 0.6rem;
      overflow-y: auto;
    }
    .card {
      background: #fff;
      border-radius: 16px;
      padding: 1rem;
      box-shadow: var(--card-shadow);
      margin-bottom: 1.13rem;
    }
    .button, .btn {
      background: linear-gradient(90deg, #43a047 60%, #1976d2 120%);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 0.7rem 0;
      font-weight: 700;
      margin-top: 0.45rem;
      width: 100%;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(76,175,80,0.08);
      transition: background 0.23s, transform 0.18s;
    }
    .button:disabled, .btn:disabled {
      background: #bdbdbd !important;
      color: #fff !important;
      cursor: not-allowed;
    }
    nav {
      display: flex;
      justify-content: space-around;
      background: #e3f2fd;
      padding: 0.4rem 0;
      border-top: 1px solid #e0e0e0;
    }
    nav button {
      background: none;
      border: none;
      color: #1976d2;
      font-size: 1.13rem;
      cursor: pointer;
      border-radius: 9px;
      padding: 0.36rem 0.9rem;
      font-weight: 600;
      transition: background 0.18s;
    }
    nav button.active, nav button:focus {
      background: var(--active-tab);
      color: #1976d2;
    }
    .eco-tip {
      background: #dcedc8;
      color: #33691e;
      padding: 0.6rem 1rem;
      border-radius: 12px;
      margin: 0.7rem 0 1.1rem 0;
      font-size: 0.99rem;
      text-align: center;
      font-weight: 600;
      box-shadow: 0 2px 7px rgba(76,175,80,0.04);
    }
    .eco-kpi {
      display: flex;
      justify-content: space-between;
      gap: 0.8rem;
      margin: 0.5rem 0 1rem 0;
    }
    .eco-kpi-card {
      background: #e8f5e9;
      border-radius: 10px;
      padding: 0.7rem 0.3rem;
      flex: 1;
      text-align: center;
      color: #388e3c;
      font-weight: bold;
      font-size: 0.99em;
      box-shadow: 0 2px 7px rgba(76,175,80,0.04);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .eco-kpi-card .eco-icon {
      font-size: 1.5em;
      margin-bottom: 0.15em;
    }
    /* Section/Tab switcher (for Driver/Store nav) */
    .section { display: none; }
    .section.active { display: block; }
    /* Small anim/fadeIn */
    @keyframes fadeIn { from{opacity:0;transform:translateY(22px);} to{opacity:1;transform:translateY(0);} }
    /* Progress bar for eco stats */
    .eco-progress-bar {
      background: #e3f2fd;
      border-radius: 8px;
      height: 22px;
      margin-bottom: 0.7rem;
      overflow: hidden;
      width: 100%;
      position: relative;
    }
    .eco-progress-bar-inner {
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, #43a047 80%, #1976d2 130%);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      font-weight: bold;
      font-size: 1rem;
      border-radius: 8px;
      transition: width 0.33s, background 0.2s;
      padding-right: 11px;
      box-sizing: border-box;
      position: absolute;
      left: 0; top: 0;
      height: 100%;
    }
    /* Map styling */
    #liveMap {
      width: 100%;
      height: 180px;
      border-radius: 11px;
      margin: 0.7rem 0 0.4rem 0;
      box-shadow: 0 2px 6px rgba(33,150,243,0.11);
      border: 1px solid #b2dfdb;
    }
  </style>
</head>
<body>
  <div class="device-frame">
    <div class="status-bar">
      <span>9:41 AM</span>
      <span>üì∂ üîã</span>
    </div>
    <div class="main-switcher">
      <button id="switchBusiness" class="active">üè¢ Business</button>
      <button id="switchDriver">üöö Driver</button>
      <button id="switchStore">üè¨ Store</button>
    </div>
    <!-- BUSINESS APP -->
    <div id="businessApp" class="app-view active">
      <header><span class="eco-icon">üå±</span>EvoSustain Business</header>
      <main>
        <div class="eco-tip">üí° <b>Eco Tip:</b> Use live KPIs to make your operation greener and more efficient!</div>
        <section id="b-login" class="card section active">
          <h3>Login</h3>
          <input type="text" placeholder="Email" style="width:100%;padding:0.5rem;margin-bottom:0.5rem;border-radius:8px;border:1px solid #ccc;">
          <input type="password" placeholder="Password" style="width:100%;padding:0.5rem;border-radius:8px;border:1px solid #ccc;">
          <button class="button" onclick="loginBusiness()">Sign In</button>
        </section>
        <section id="b-home" class="card section">
          <h3>Welcome to EvoSustain!</h3>
          <div class="eco-kpi">
            <div class="eco-kpi-card"><span class="eco-icon">üè¨</span>500 Stores</div>
            <div class="eco-kpi-card"><span class="eco-icon">üöö</span>10 Drivers</div>
            <div class="eco-kpi-card"><span class="eco-icon">üåç</span>2.1 tons CO‚ÇÇ Saved</div>
          </div>
          <div class="eco-kpi">
            <div class="eco-kpi-card"><span class="eco-icon">üå≥</span>19 Trees Saved</div>
            <div class="eco-kpi-card"><span class="eco-icon">üîã</span>89% Renewable</div>
            <div class="eco-kpi-card"><span class="eco-icon">üèÖ</span>Gold Eco Rating</div>
          </div>
          <div class="eco-progress-bar" style="margin-top:1rem;">
            <div class="eco-progress-bar-inner" id="ecoBusinessBar">0%</div>
          </div>
        </section>
        <section id="b-dashboard" class="card section">
          <h3>KPIs Overview</h3>
          <p>‚è± Avg. Route Time: 32 min</p>
          <p>‚úÖ Completed Tasks: 440</p>
          <p>‚ö†Ô∏è Alerts: 3 system issues</p>
          <div id="liveMap"></div>
        </section>
      </main>
      <nav>
        <button onclick="showBusiness('b-home', true)">üè† Home</button>
        <button onclick="showBusiness('b-dashboard')">üìä KPIs</button>
      </nav>
    </div>
    <!-- DRIVER APP -->
    <div id="driverApp" class="app-view">
      <header><span class="eco-icon">üöö</span>EvoSustain Driver</header>
      <main>
        <div class="eco-tip">üí° <b>Green Tip:</b> Use Smart Fast mode for optimized eco-routes in London!</div>
        <section id="d-home" class="card section active">
          <h3>Start Shift</h3>
          <input type="text" id="driverIdInput" placeholder="Driver ID" style="width:100%;padding:0.5rem;" />
          <button class="button" id="startBtn">Start</button>
          <button class="button" id="breakBtn">Break</button>
          <button class="button" id="endBtn">End Shift</button>
          <button class="button" id="callSupportBtnHome">Call Support</button>
        </section>
        <section id="d-route" class="card section">
          <h3>Route Stops</h3>
          <input type="number" id="goto-stop" placeholder="Go to Stop #" style="width:100%;padding:0.5rem;margin:0.5rem 0;" />
          <button class="button" id="gotoBtn">Go</button>
          <label for="route-mode">Route Mode:</label>
          <select id="route-mode" class="route-mode">
            <option value="normal">Normal</option>
            <option value="fast">Smart Fast</option>
          </select>
          <ul id="stop-list"></ul>
          <p style="font-size:0.88rem;color:#1976d2;margin-top:1rem;">100 eco stops in London are grouped here. Use Smart Fast for sustainability and efficiency.</p>
          <button class="button" id="mapBtn">Map</button>
          <button class="button" id="callSupportBtnRoute">Call Support</button>
        </section>
        <section id="d-map" class="card section">
          <h3>Eco Map</h3>
          <p>London route simulation.</p>
          <div id="map-canvas">Simulated Map</div>
          <button class="button" id="drawRouteBtn">Go Route</button>
        </section>
        <section id="d-summary" class="card section">
          <div class="eco-progress-bar">
            <div class="eco-progress-bar-inner" id="progress-bar"><span id="progress-label">0%</span></div>
          </div>
          <h3>Summary</h3>
          <p id="summary-data">Loading...</p>
          <button class="button" id="submitReportBtn">Submit</button>
          <button class="button" id="callSupportBtnSummary">Call Support</button>
        </section>
      </main>
      <nav>
        <button onclick="showDriver('d-home')">üè†</button>
        <button onclick="showDriver('d-route')">üß≠</button>
        <button onclick="showDriver('d-map')">üó∫Ô∏è</button>
        <button onclick="showDriver('d-summary')">üìä</button>
      </nav>
    </div>
    <!-- STORE APP -->
    <div id="storeApp" class="app-view">
      <header><span class="eco-icon">üè¨</span>EvoSustain Store</header>
      <main>
        <div class="eco-tip">üí° Order eco-friendly supplies and track your pickups easily!</div>
        <section id="s-login" class="card section active">
          <h3>Login / Sign-Up</h3>
          <input type="text" placeholder="Store ID" style="width:100%;padding:0.5rem;margin-top:0.5rem;border-radius:8px;border:1px solid #ccc;">
          <button class="button" onclick="showStoreSection('s-request')">Login</button>
          <button class="button" onclick="showStoreSection('s-request')">Scan QR Code</button>
        </section>
        <section id="s-request" class="card section">
          <h3>Request Collection</h3>
          <button class="button" onclick="showStoreSection('s-login')">‚Üê Back</button>
          <p><strong>Location:</strong> Auto-filled</p>
          <p><strong>Bin Type:</strong> Auto-filled</p>
          <input type="number" placeholder="Volume (m¬≥)" style="width:100%;padding:0.5rem;border-radius:8px;border:1px solid #ccc;">
          <select style="width:100%;padding:0.5rem;border-radius:8px;border:1px solid #ccc;margin-top:0.5rem;">
            <option>Select Time Window</option>
            <option>9:00‚Äì11:00</option>
            <option>11:00‚Äì13:00</option>
            <option>13:00‚Äì15:00</option>
          </select>
          <textarea placeholder="Additional Notes" rows="3" style="width:100%;margin-top:0.5rem;padding:0.5rem;border-radius:8px;border:1px solid #ccc;"></textarea>
          <button class="button" onclick="showStoreSection('s-track')">Submit Request</button>
        </section>
        <section id="s-track" class="card section">
          <h3>Track Collection</h3>
          <button class="button" onclick="showStoreSection('s-request')">‚Üê Back</button>
          <ul>
            <li>Requested ‚úÖ</li>
            <li>Accepted ‚úÖ</li>
            <li><strong>In Transit üöö</strong></li>
            <li>Collected ‚è≥</li>
          </ul>
        </section>
        <section id="s-history" class="card section">
          <h3>Pickup History</h3>
          <button class="button" onclick="showStoreSection('s-track')">‚Üê Back</button>
          <p>üìÖ 20 May - Food Waste - <strong>Collected</strong></p>
          <p>üìÖ 18 May - Recycling - <strong>Collected</strong></p>
          <p>üìÖ 16 May - Glass - <strong>Collected</strong></p>
          <p>üìÖ 14 May - Cardboard - <strong>Missed</strong></p>
          <p>üìÖ 12 May - Plastic - <strong>Collected</strong></p>
          <p>üìÖ 10 May - General Waste - <strong>Collected</strong></p>
        </section>
        <section id="s-help" class="card section">
          <h3>Settings & Help</h3>
          <button class="button" onclick="showStoreSection('s-history')">‚Üê Back</button>
          <p><strong>Support Chat:</strong> Coming soon</p>
          <p><strong>FAQ:</strong> How to request, track, and update your profile</p>
          <p><strong>Profile:</strong> Edit and update your store info (coming soon)</p>
        </section>
        <section id="s-notifications" class="card section">
          <h3>Notifications</h3>
          <button class="button" onclick="showStoreSection('s-help')">‚Üê Back</button>
          <ul>
            <li>üì¢ New collection slot available for weekends.</li>
            <li>‚úÖ Your last pickup on 20 May was successful.</li>
            <li>üì¶ New bins will be delivered next week.</li>
          </ul>
        </section>
        <section id="s-orders" class="card section">
          <h3>Order Supplies</h3>
          <button class="button" onclick="showStoreSection('s-notifications')">‚Üê Back</button>
          <select style="width:100%;padding:0.5rem;margin-bottom:0.5rem;">
            <option>Select Item</option>
            <option>New Bin</option>
            <option>Bin Liners</option>
            <option>QR Code Stickers</option>
            <option>Trash Bags</option>
            <option>Cleaning Products</option>
            <option>Other</option>
          </select>
          <input type="number" placeholder="Quantity" style="width:100%;padding:0.5rem;margin-bottom:0.5rem;">
          <textarea placeholder="Additional Notes (optional)" rows="3" style="width:100%;padding:0.5rem;border-radius:8px;border:1px solid #ccc;"></textarea>
          <button class="button" onclick="alert('Order request submitted!')">Submit Order</button>
        </section>
      </main>
      <nav>
        <button onclick="showStoreSection('s-login')">üè†</button>
        <button onclick="showStoreSection('s-request')">üóëÔ∏è</button>
        <button onclick="showStoreSection('s-track')">üì¶</button>
        <button onclick="showStoreSection('s-history')">üìú</button>
        <button onclick="showStoreSection('s-help')">‚ùì</button>
        <button onclick="showStoreSection('s-notifications')">üîî</button>
        <button onclick="showStoreSection('s-orders')">‚ûï</button>
      </nav>
    </div>
  </div>
  <script>
    // Main App Switcher
    function setActiveApp(appId) {
      document.querySelectorAll('.app-view').forEach(view => view.classList.remove('active'));
      document.getElementById(appId).classList.add('active');
      document.querySelectorAll('.main-switcher button').forEach(btn => btn.classList.remove('active'));
      if(appId==='businessApp') document.getElementById('switchBusiness').classList.add('active');
      if(appId==='driverApp') document.getElementById('switchDriver').classList.add('active');
      if(appId==='storeApp') document.getElementById('switchStore').classList.add('active');
    }
    document.getElementById('switchBusiness').onclick = ()=>setActiveApp('businessApp');
    document.getElementById('switchDriver').onclick = ()=>setActiveApp('driverApp');
    document.getElementById('switchStore').onclick = ()=>setActiveApp('storeApp');

    // Business Nav
    function showBusiness(sectionId, updateEcoBar) {
      document.querySelectorAll('#businessApp main .section').forEach(s=>s.classList.remove('active'));
      document.getElementById(sectionId).classList.add('active');
      // Example eco bar
      if(updateEcoBar) {
        let percent = 76;
        let ecoBar = document.getElementById('ecoBusinessBar');
        ecoBar.style.width = percent + "%";
        ecoBar.textContent = percent + "% Green";
      }
      if(sectionId === 'b-dashboard' && !window.mapLoaded) {
        setTimeout(() => {
          let map = L.map('liveMap').setView([51.505, -0.09], 12);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
          }).addTo(map);
          window.mapLoaded = true;
        }, 120);
      }
    }
    function loginBusiness() {
      showBusiness('b-home', true);
    }

    // --- Driver Logic (integrated, eco)
    let stops = Array.from({ length: 100 }, (_, i) => ({
      id: i + 1,
      label: `Stop ${i + 1}, London, UK`,
      lat: 51.5 + Math.random() * 0.1,
      lon: -0.15 + Math.random() * 0.1,
      status: 'pending', // pending, confirmed, delayed, noted
    }));
    function showDriver(sectionId) {
      document.querySelectorAll('#driverApp main .section').forEach(s=>s.classList.remove('active'));
      document.getElementById(sectionId).classList.add('active');
      if(sectionId==='d-route'){renderRoute(); updateSummary(); drawRoute();}
      if(sectionId==='d-map'){drawRoute();}
      if(sectionId==='d-summary'){updateSummary();}
    }
    function renderRoute() {
      const list = document.getElementById('stop-list');
      if (!list) return;
      list.innerHTML = '';
      const mode = document.getElementById('route-mode').value;
      let displayStops = [...stops];
      if (mode === 'fast') {
        const baseLat = 51.5074, baseLon = -0.1278;
        displayStops = [...stops].sort((a, b) => {
          if (a.status === "confirmed" && b.status !== "confirmed") return 1;
          if (a.status !== "confirmed" && b.status === "confirmed") return -1;
          if (a.status === "confirmed" && b.status === "confirmed") return 0;
          const dA = Math.hypot(baseLat - a.lat, baseLon - a.lon);
          const dB = Math.hypot(baseLat - b.lat, baseLon - b.lon);
          return dA - dB;
        });
      } else {
        displayStops = [...stops].sort((a, b) => {
          if (a.status === "confirmed" && b.status !== "confirmed") return 1;
          if (a.status !== "confirmed" && b.status === "confirmed") return -1;
          return a.id - b.id;
        });
      }
      displayStops.forEach(stop => {
        const li = document.createElement('li');
        li.setAttribute('id', `stop-${stop.id}`);
        li.className = stop.status !== 'pending' ? stop.status : '';
        const info = document.createElement('div');
        info.textContent = stop.label;
        const actions = document.createElement('div');
        actions.className = 'actions';
        // Confirm
        const btnConfirm = document.createElement('button');
        btnConfirm.className = 'button';
        btnConfirm.textContent = stop.status === 'confirmed' ? 'Confirmed' : 'Confirm';
        btnConfirm.disabled = stop.status === 'confirmed';
        btnConfirm.style.backgroundColor = stop.status === 'confirmed' ? '#4caf50' : '';
        btnConfirm.onclick = () => {
          if (stop.status !== 'confirmed') {
            stop.status = 'confirmed';
            renderRoute(); updateSummary(); drawRoute();
          }
        };
        // Delay
        const btnDelay = document.createElement('button');
        btnDelay.className = 'button';
        btnDelay.textContent = stop.status === 'delayed' ? 'Delayed' : 'Delay';
        btnDelay.disabled = stop.status === 'confirmed' || stop.status === 'delayed';
        btnDelay.style.backgroundColor = stop.status === 'delayed' ? '#f44336' : '';
        btnDelay.onclick = () => {
          if (stop.status !== 'confirmed' && stop.status !== 'delayed') {
            stop.status = 'delayed';
            renderRoute(); updateSummary(); drawRoute();
          }
        };
        // Note
        const btnNote = document.createElement('button');
        btnNote.className = 'button';
        btnNote.textContent = stop.status === 'noted' ? 'Noted' : 'Note';
        btnNote.disabled = stop.status === 'confirmed' || stop.status === 'noted';
        btnNote.style.backgroundColor = stop.status === 'noted' ? '#ff9800' : '';
        btnNote.onclick = () => {
          if (stop.status !== 'confirmed' && stop.status !== 'noted') {
            stop.status = 'noted';
            renderRoute(); updateSummary(); drawRoute();
          }
        };
        actions.appendChild(btnConfirm); actions.appendChild(btnDelay); actions.appendChild(btnNote);
        li.appendChild(info); li.appendChild(actions);
        list.appendChild(li);
      });
    }
    function updateSummary() {
      const total = stops.length;
      const confirmedCount = stops.filter(s => s.status === "confirmed").length;
      const delayedCount = stops.filter(s => s.status === "delayed").length;
      const notedCount = stops.filter(s => s.status === "noted").length;
      const progressBar = document.getElementById('progress-bar');
      const progressLabel = document.getElementById('progress-label');
      const summaryData = document.getElementById('summary-data');
      const percent = Math.round((confirmedCount / total) * 100);
      progressBar.style.width = `${percent}%`;
      progressLabel.textContent = `${percent}%`;
      if (percent < 30) {
        progressBar.style.background = '#f44336';
      } else if (percent < 70) {
        progressBar.style.background = '#ffeb3b';
      } else {
        progressBar.style.background = '#4caf50';
      }
      summaryData.innerHTML = `Confirmed: ${confirmedCount} / ${total}<br/>Delayed: ${delayedCount}<br/>Noted: ${notedCount}`;
    }
    function goToStop() {
      const id = parseInt(document.getElementById('goto-stop').value);
      if (!isNaN(id) && id > 0 && id <= stops.length) {
        const el = document.getElementById(`stop-${id}`);
        if (el) {
          el.scrollIntoView({ behavior: 'smooth', block: 'start' });
          el.style.backgroundColor = '#fff59d';
          setTimeout(() => { el.style.backgroundColor = ''; }, 1800);
        }
      }
    }
    function drawRoute() {
      const canvas = document.getElementById('map-canvas');
      if (!canvas) return;
      canvas.innerHTML = '';
      const svgNS = 'http://www.w3.org/2000/svg';
      const width = 300, height = 190, paddingX = 20, paddingY = 22, stepX = 26, stepY = 15;
      const svg = document.createElementNS(svgNS, 'svg');
      svg.setAttribute('width', width);
      svg.setAttribute('height', height);
      for (let i = 0; i < stops.length - 1; i++) {
        const x1 = paddingX + (i % 10) * stepX;
        const y1 = paddingY + Math.floor(i / 10) * stepY;
        const x2 = paddingX + ((i + 1) % 10) * stepX;
        const y2 = paddingY + Math.floor((i + 1) / 10) * stepY;
        const line = document.createElementNS(svgNS, 'line');
        line.setAttribute('x1', x1); line.setAttribute('y1', y1);
        line.setAttribute('x2', x2); line.setAttribute('y2', y2);
        line.setAttribute('stroke', '#bdbdbd');
        line.setAttribute('stroke-width', '1');
        svg.appendChild(line);
      }
      stops.forEach((stop, index) => {
        const cx = paddingX + (index % 10) * stepX;
        const cy = paddingY + Math.floor(index / 10) * stepY;
        const circle = document.createElementNS(svgNS, 'circle');
        circle.setAttribute('cx', cx);
        circle.setAttribute('cy', cy);
        circle.setAttribute('r', 8);
        let fill = '#42a5f5';
        if (stop.status === 'confirmed') fill = '#4caf50';
        else if (stop.status === 'delayed') fill = '#f44336';
        else if (stop.status === 'noted') fill = '#ff9800';
        circle.setAttribute('fill', fill);
        circle.setAttribute('stroke', '#222');
        circle.setAttribute('stroke-width', '1');
        svg.appendChild(circle);
        const text = document.createElementNS(svgNS, 'text');
        text.setAttribute('x', cx);
        text.setAttribute('y', cy + 4);
        text.setAttribute('text-anchor', 'middle');
        text.setAttribute('font-size', '7');
        text.setAttribute('fill', '#fff');
        text.textContent = stop.id;
        svg.appendChild(text);
      });
      canvas.appendChild(svg);
    }
    // Driver event listeners
    setTimeout(() => {
      document.getElementById('startBtn').onclick = ()=>showDriver('d-route');
      document.getElementById('endBtn').onclick = ()=>showDriver('d-summary');
      document.getElementById('breakBtn').onclick = ()=>alert('Break started');
      document.getElementById('gotoBtn').onclick = goToStop;
      document.getElementById('route-mode').onchange = ()=>{renderRoute();updateSummary();drawRoute();};
      document.getElementById('mapBtn').onclick = ()=>showDriver('d-map');
      document.getElementById('drawRouteBtn').onclick = drawRoute;
      document.getElementById('submitReportBtn').onclick = ()=>alert('Eco report submitted! Great job! üå±');
      document.getElementById('callSupportBtnHome').onclick = ()=>alert('Calling support...');
      document.getElementById('callSupportBtnRoute').onclick = ()=>alert('Calling support...');
      document.getElementById('callSupportBtnSummary').onclick = ()=>alert('Calling support...');
    }, 200);

    // --- Store Logic
    function showStoreSection(sectionId) {
      document.querySelectorAll('#storeApp main .section').forEach(s=>s.classList.remove('active'));
      document.getElementById(sectionId).classList.add('active');
    }
    showBusiness('b-login');
    showStoreSection('s-login');
  </script>
</body>
</html>
